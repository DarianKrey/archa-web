<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archa | The Aegean Archive</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,400&family=Inter:wght@300;400&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #fdfbf7;
            --charcoal: #1a1a1a;
            --border: #eceae6;
            --aegean: #0c2d48;
            --aegean-light: #1a4d6f;
            --serif: 'Cormorant Garamond', Georgia, serif;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--cream); color: var(--charcoal); margin: 0; min-height: 100vh; padding-bottom: 60px; }
        .header {
            background: var(--aegean);
            color: var(--cream);
            padding: 48px 24px 56px;
            text-align: center;
        }
        .header h1 {
            font-family: var(--serif);
            font-size: clamp(2.25rem, 5vw, 3.5rem);
            font-weight: 400;
            letter-spacing: 0.08em;
            margin: 0 0 8px;
            text-transform: uppercase;
        }
        .header .tagline {
            font-family: var(--serif);
            font-size: 1.1rem;
            font-weight: 300;
            letter-spacing: 0.04em;
            opacity: 0.92;
            margin: 0;
        }
        .recent-adventures {
            max-width: 1100px;
            margin: -28px auto 0;
            padding: 0 24px;
            position: relative;
            z-index: 1;
        }
        .recent-adventures h2 {
            font-family: var(--serif);
            font-size: 0.75rem;
            font-weight: 500;
            letter-spacing: 0.2em;
            text-transform: uppercase;
            color: var(--aegean);
            margin: 0 0 20px;
        }
        .adventures-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 12px;
        }
        .adventure-card {
            aspect-ratio: 4/5;
            background: linear-gradient(145deg, var(--aegean-light) 0%, var(--aegean) 100%);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        .adventure-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .adventure-card .placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(253, 251, 247, 0.4);
            font-family: var(--serif);
            font-size: 0.85rem;
            font-weight: 300;
            letter-spacing: 0.1em;
        }
        .container-wrap { display: flex; justify-content: center; padding: 40px 24px 0; }
        .container { max-width: 450px; width: 100%; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 20px 40px rgba(0,0,0,0.06); text-align: center; }
        h1:not(.header h1) { font-family: var(--serif); font-size: 2.5rem; margin-bottom: 10px; font-weight: 400; letter-spacing: -1px; }
        .container p { color: #666; line-height: 1.6; margin-bottom: 30px; font-size: 0.95rem; }
        .form-section { text-align: left; margin-bottom: 25px; }
        label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1.5px; color: #999; display: block; margin-bottom: 8px; font-weight: 700; }
        input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 4px; box-sizing: border-box; font-size: 1rem; margin-bottom: 15px; background: #fafafa; }
        .btn { width: 100%; padding: 18px; border-radius: 4px; cursor: pointer; letter-spacing: 2px; font-weight: 600; font-size: 0.85rem; transition: all 0.2s ease; border: none; margin-bottom: 10px; }
        #picker-button { background: var(--aegean); color: var(--cream); }
        #submit-btn {
            margin-top: 25px;
            background: var(--aegean);
            color: var(--cream);
            box-shadow: 0 2px 8px rgba(12, 45, 72, 0.25);
        }
        #submit-btn:hover {
            background: var(--aegean-light);
            box-shadow: 0 4px 16px rgba(12, 45, 72, 0.35);
            transform: translateY(-1px);
        }
        #submit-btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(12, 45, 72, 0.3);
        }
        #submit-btn:focus-visible {
            outline: 2px solid var(--aegean);
            outline-offset: 2px;
        }
        .upload-area { border: 2px dashed var(--border); padding: 20px; border-radius: 4px; background: #fafafa; cursor: pointer; }
        .upload-area p { margin: 0; font-size: 0.8rem; color: #888; }
        #file-input { display: none; }
        .divider { margin: 20px 0; font-size: 0.7rem; color: #ccc; text-transform: uppercase; letter-spacing: 2px; display: flex; align-items: center; }
        .divider::before, .divider::after { content: ""; flex: 1; height: 1px; background: var(--border); margin: 0 10px; }
        #preview-container { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 15px; justify-content: center; }
        .preview-img { width: 50px; height: 50px; object-fit: cover; border-radius: 2px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<header class="header">
    <h1>Archa</h1>
    <p class="tagline">The Aegean Archive</p>
</header>

<section class="recent-adventures">
    <h2>Recent Adventures</h2>
    <div class="adventures-grid">
        <div class="adventure-card"><span class="placeholder">Santorini</span></div>
        <div class="adventure-card"><span class="placeholder">Crete</span></div>
        <div class="adventure-card"><span class="placeholder">Mykonos</span></div>
        <div class="adventure-card"><span class="placeholder">Rhodes</span></div>
        <div class="adventure-card"><span class="placeholder">Naxos</span></div>
    </div>
</section>

<div class="container-wrap">
<div class="container" id="main-content">
    <h1>Begin Your Archive</h1>
    <p id="sub-header">Curating your finest moments into a timeless physical archive.</p>

    <form name="archa-alpha-onboarding" method="POST" data-netlify="true" id="onboarding-form" enctype="multipart/form-data" action="/">
        <div class="form-section">
            <label>Full Name</label>
            <input type="text" name="name" id="user-name" placeholder="Darian Allberry" required>
            <label>Email Address</label>
            <input type="email" name="email" id="user-email" placeholder="darian@example.com" required>
        </div>

        <button type="button" id="picker-button" class="btn">ACCESS GOOGLE PHOTOS</button>
        <div class="divider">or</div>
        <div class="upload-area" onclick="document.getElementById('file-input').click()">
            <p>UPLOAD FROM DEVICE</p>
            <input type="file" name="manual-photos" id="file-input" multiple accept="image/*">
            <div id="preview-container"></div>
        </div>

        <button type="submit" id="submit-btn" class="btn">SUBMIT ARCHIVE</button>
    </form>
</div>
</div>

<script src="https://accounts.google.com/gsi/client"></script>
<script src="https://apis.google.com/js/api.js"></script>

<script>
    const CLIENT_ID = '395230076534-7p1jg57bplj9j74e1adk2uu0r9n4qujv.apps.googleusercontent.com';
    const API_KEY = 'AIzaSyC1JJSgIqHsHSMUrVPQGIy_eXm1wwSwSTc';
    const APP_ID = '395230076534';

    let tokenClient;
    let accessToken = null;

    gapi.load('picker', () => { console.log("Picker Ready"); });
    window.onload = () => {
        if (window.location.protocol === 'file:') {
            console.warn('This page is open from file://. Form submit and Google sign-in will fail. Run a local server (e.g. npx serve .) or deploy to Netlify.');
        }
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: 'https://www.googleapis.com/auth/photospicker.mediaitems.readonly',
            callback: (resp) => {
                if (resp.error) {
                    console.error('Google sign-in error:', resp);
                    alert('Sign-in failed: ' + (resp.error_description || resp.error || 'Unknown error') + '. Try deploying this page to Netlify or running a local server—file:// pages often fail.');
                    return;
                }
                accessToken = resp.access_token;
                createPicker();
            },
        });
    };

    function createPicker() {
        const picker = new google.picker.PickerBuilder()
            .addView(google.picker.ViewId.PHOTOS)
            .setOAuthToken(accessToken)
            .setDeveloperKey(API_KEY)
            .setAppId(APP_ID)
            .setOrigin(window.location.protocol + '//' + window.location.host)
            .setCallback((data) => {
                if (data.action === google.picker.Action.CANCEL) return;
                if (data.error) {
                    console.error('Picker error:', data);
                    alert('Google Photos error: ' + (data.error.message || data.error || 'Unknown error'));
                    return;
                }
                if (data.action === google.picker.Action.PICKED) {
                    handleSuccess();
                }
            })
            .build();
        picker.setVisible(true);
    }

    function handleSuccess() {
        document.getElementById('onboarding-form').classList.add('hidden');
        document.getElementById('sub-header').innerText = "Archive linked. Our curators will reach out to you within 24 hours.";
        const form = document.getElementById('onboarding-form');
        const formData = new FormData(form);
        formData.append('form-name', 'archa-alpha-onboarding');
        const action = form.getAttribute('action') || '/';
        fetch(action, {
            method: "POST",
            body: formData,
            // Do not set Content-Type; browser sets multipart/form-data with boundary
        })
        .then(() => { /* success */ })
        .catch(err => {
            console.error('Submit failed:', err);
            document.getElementById('sub-header').innerText = "Archive linked. If this page didn’t redirect, submit again once the site is live on Netlify.";
        });
    }

    document.getElementById('picker-button').addEventListener('click', () => {
        if (!document.getElementById('user-name').value) return alert("Enter your name first.");
        tokenClient.requestAccessToken({prompt: 'consent'});
    });

    document.getElementById('file-input').addEventListener('change', function(e) {
        const preview = document.getElementById('preview-container');
        preview.innerHTML = '';
        Array.from(this.files).forEach(file => {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = document.createElement('img');
                img.src = event.target.result;
                img.className = 'preview-img';
                preview.appendChild(img);
            };
            reader.readAsDataURL(file);
        });
    });
</script>

</body>
</html>